<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artículos Majahua</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f4ede1;
            color: #333;
        }
        h1 {
            background-color: #d97706;
            color: white;
            padding: 10px;
            border-radius: 10px;
        }
        input, select, button, textarea {
            margin: 5px;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        button {
            background-color: #d97706;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
        button:hover {
            background-color: #b65c04;
        }
        #item-list {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .item {
            border: 2px solid #d97706;
            background-color: #fff;
            padding: 15px;
            margin: 10px;
            border-radius: 10px;
            width: 250px;
            box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);
        }
        .item img {
            max-width: 100px;
            border-radius: 5px;
        }
        footer {
            margin-top: 30px;
            background-color: #222;
            color: white;
            padding: 15px;
            font-size: 14px;
        }
        .high-contrast {
            background-color: black !important;
            color: yellow !important;
        }
        .high-contrast h1 {
            background-color: yellow !important;
            color: black !important;
        }
        .high-contrast button {
            background-color: yellow !important;
            color: black !important;
        }
    </style>
</head>
<body>
    <h1>Artículos Majahua</h1>
    <button onclick="toggleContrast()">Modo Alto Contraste</button>
    <input type="text" id="item-name" placeholder="Nombre del ítem">
    <input type="file" id="item-image" accept="image/*">
    <input type="text" id="item-brand" placeholder="Marca">
    <input type="text" id="item-description" placeholder="Descripción">
    <input type="text" id="item-weight" placeholder="Peso (kg)">
    <input type="text" id="item-condition" placeholder="Estado">
    <input type="text" id="item-market-value" placeholder="Valor de mercado ($)">
    <input type="text" id="item-recycle-value" placeholder="Valor reciclaje ($/kg)">
    <input type="text" id="item-serial" placeholder="Número de serie">
    <input type="text" id="item-invoice" placeholder="Factura">
    <input type="text" id="item-location" placeholder="Ubicación">
    <input type="date" id="item-date" placeholder="Fecha de ingreso">
    <input type="text" id="item-owner" placeholder="Propietario">
    <textarea id="item-notes" placeholder="Notas adicionales"></textarea>
    <select id="item-category">
        <option value="Reciclar">Reciclar</option>
        <option value="Vender">Vender</option>
        <option value="Redirigir">Redirigir</option>
        <option value="Reutilizar">Reutilizar</option>
    </select>
    <button onclick="addItem()">Agregar Ítem</button>
    <button onclick="exportToExcel()">Exportar a Excel</button>
    
    <div id="item-list"></div>

    <footer>
        © 2025 Terraequipo® - Optimización y gestión de equipos pesados.
    </footer>
    
    <!-- Incluir librerías para exportación -->
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <script>
        // Array para almacenar todos los artículos
        let allItems = [];
        
        function addItem() {
            let name = document.getElementById('item-name').value.trim(); 
            let brand = document.getElementById('item-brand').value.trim();
            let description = document.getElementById('item-description').value.trim();
            let weightStr = document.getElementById('item-weight').value.trim();
            let condition = document.getElementById('item-condition').value.trim();
            let marketValueStr = document.getElementById('item-market-value').value.trim();
            let recycleValueStr = document.getElementById('item-recycle-value').value.trim();
            let serial = document.getElementById('item-serial').value.trim();
            let invoice = document.getElementById('item-invoice').value.trim();
            let location = document.getElementById('item-location').value.trim();
            let date = document.getElementById('item-date').value.trim();
            let owner = document.getElementById('item-owner').value.trim();
            let notes = document.getElementById('item-notes').value.trim();
            let category = document.getElementById('item-category').value;
            let imageInput = document.getElementById('item-image');
            let imageFile = imageInput.files[0];
            let imageSrc = ''; 

            if (name === '') {
                alert('Por favor, ingrese un nombre para el ítem.');
                return;
            }

            let weight = parseFloat(weightStr);
            if (isNaN(weight)) {
                weight = 0; 
            }
            let marketValue = parseFloat(marketValueStr);
            if (isNaN(marketValue)) {
                marketValue = 0; 
            }
            let recycleValue = parseFloat(recycleValueStr);
            if (isNaN(recycleValue)) {
                recycleValue = 0; 
            }

            // Crear objeto del artículo para guardarlo
            let item = {
                name, brand, description, weight, condition, 
                marketValue, recycleValue, serial, invoice, 
                location, date, owner, notes, category
            };

            if (imageFile) {
                let reader = new FileReader();
                reader.onload = function (e) {
                    imageSrc = `<img src="${e.target.result}" width="100"><br>`;
                    item.imageData = e.target.result;
                    allItems.push(item);
                    createItemDiv(name, brand, description, weight, condition, marketValue, recycleValue, 
                                 serial, invoice, location, date, owner, notes, category, imageSrc, allItems.length - 1);
                };
                reader.readAsDataURL(imageFile);
            } else {
                allItems.push(item);
                createItemDiv(name, brand, description, weight, condition, marketValue, recycleValue, 
                             serial, invoice, location, date, owner, notes, category, imageSrc, allItems.length - 1); 
            }
        }

        function createItemDiv(name, brand, description, weight, condition, marketValue, recycleValue, serial, invoice, location, date, owner, notes, category, imageSrc, itemIndex) {
            let itemList = document.getElementById('item-list');
            let itemDiv = document.createElement('div');
            itemDiv.classList.add('item');
            itemDiv.dataset.index = itemIndex;
            
            itemDiv.innerHTML = `<strong>${name} (${brand})</strong><br>
                                ${imageSrc}
                                Descripción: ${description}<br>
                                Peso: ${weight} kg<br>
                                Estado: ${condition}<br>
                                Valor de mercado: $${marketValue}<br>
                                Valor reciclaje: $${recycleValue}/kg<br>
                                Número de serie: ${serial}<br>
                                Factura: ${invoice}<br>
                                Ubicación: ${location}<br>
                                Fecha de ingreso: ${date}<br>
                                Propietario: ${owner}<br>
                                Notas: ${notes}<br>
                                Categoría: ${category}
                                <br><button onclick="exportToPDF(${itemIndex})">Exportar a PDF</button>`;
            
            itemList.appendChild(itemDiv);
            alert('Ítem agregado correctamente.');

            document.getElementById('item-name').value = '';
            document.getElementById('item-brand').value = '';
            document.getElementById('item-description').value = '';
            document.getElementById('item-weight').value = '';
            document.getElementById('item-condition').value = '';
            document.getElementById('item-market-value').value = '';
            document.getElementById('item-recycle-value').value = '';
            document.getElementById('item-serial').value = '';
            document.getElementById('item-invoice').value = '';
            document.getElementById('item-location').value = '';
            document.getElementById('item-date').value = '';
            document.getElementById('item-owner').value = '';
            document.getElementById('item-notes').value = '';
            document.getElementById('item-category').value = 'Reciclar'; 
            document.getElementById('item-image').value = '';
        }
        
        // Función para exportar a Excel
        function exportToExcel() {
            if (allItems.length === 0) {
                alert('No hay artículos para exportar.');
                return;
            }
            
            // Crear una hoja de trabajo
            let workbook = XLSX.utils.book_new();
            let worksheet = XLSX.utils.json_to_sheet(allItems);
            
            // Añadir la hoja al libro
            XLSX.utils.book_append_sheet(workbook, worksheet, "Artículos");
            
            // Generar el archivo Excel
            XLSX.writeFile(workbook, "articulos_majahua.xlsx");
        }
        
        // Función para exportar a PDF
        function exportToPDF(itemIndex) {
            const { jsPDF } = window.jspdf;
            
            // Obtener el elemento del artículo
            let itemDiv = document.querySelector(`.item[data-index="${itemIndex}"]`);
            if (!itemDiv) {
                alert('No se pudo encontrar el artículo.');
                return;
            }
            
            // Crear copia temporal para screenshot
            let tempDiv = itemDiv.cloneNode(true);
            tempDiv.style.width = "500px";
            tempDiv.style.padding = "20px";
            tempDiv.style.backgroundColor = "white";
            
            // Ocultar el botón de exportar en la copia
            let exportButton = tempDiv.querySelector('button');
            if (exportButton) {
                exportButton.style.display = 'none';
            }
            
            document.body.appendChild(tempDiv);
            
            // Crear PDF
            html2canvas(tempDiv).then(canvas => {
                document.body.removeChild(tempDiv);
                
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = pdf.internal.pageSize.getHeight();
                const imgWidth = canvas.width;
                const imgHeight = canvas.height;
                const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);
                const imgX = (pdfWidth - imgWidth * ratio) / 2;
                
                // Añadir encabezado
                pdf.setFontSize(16);
                pdf.text("Ficha Técnica - Artículos Majahua", pdfWidth/2, 15, { align: 'center' });
                
                // Añadir imagen del artículo
                pdf.addImage(imgData, 'PNG', imgX, 30, imgWidth * ratio, imgHeight * ratio);
                
                // Guardar el PDF
                const item = allItems[itemIndex];
                pdf.save(`ficha_tecnica_${item.name.replace(/\s+/g, '_')}.pdf`);
            });
        }

        function toggleContrast() {
            document.body.classList.toggle('high-contrast');
        }
    </script>
</body>
</html>
